<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 公共样式 -->
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/components.css" />
    <!-- 新增：赛博朋克风格布局 -->
    <link rel="stylesheet" href="css/cyberpunk_layout.css">
    <!-- 页面专用样式 -->
    <link rel="stylesheet" href="css/page_css/style_guide.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <link rel="stylesheet" href="./css/index2.css">
    <title>Style Guide</title>
</head>


<body>
    <main>
        <div class="container">
            <!-- 移动端导航 -->
            <nav id="nav-mobile" aria-label="Main Navigation">
                <ul>
                    <li><a href="index.html">Forum</a></li>
                    <li><a href="resourse.html">Resourse</a></li>
                    <li><a href="implementation_rationale.html">Guilds</a></li>
                    <li><a href="login.html">User</a></li>
                </ul>
            </nav>

            <!-- 桌面端导航 -->
            <nav id="nav-desktop" aria-label="Main Navigation">
                <ul>
                    <li><a href="index.html">Forum</a></li>
                    <li><a href="resourse.html">Resourse</a></li>
                    <li><a href="implementation_rationale.html">Guilds</a></li>
                    <li><a href="login.html">User</a></li>
                    <li>
                        <div id="search-wrapper">
                            <form action="#">
                                <input type="text" id="search" placeholder="Search something...">
                                <div id="close-icon"></div>
                                <input class="d-none" type="submit" value="">
                            </form>
                        </div>
                    </li>
                </ul>
            </nav>
            <!-- 主页内容 -->
            <div class="row">
                <div class="col-12">
                    <h1 style="font-size: 40px;"> MOBA</h1>
                    <p>Multiplayer online battle arena (MOBA) is a subgenre of strategy video games in which two teams of players 
                        compete on a structured battlefield, each controlling a single character with distinctive abilities that grow 
                        stronger as the match progresses. The objective is to destroy the enemy team's main structure while defending 
                        one's own. In some MOBA games, the objective can be defeating every player on the enemy team. Matches emphasize 
                        team coordination, tactical choices, and real-time combat. Players are assisted by computer-controlled units that 
                        periodically spawn in groups and march along set paths toward their enemy's base, which is heavily guarded by 
                        defensive structures. Players can influence these units by eliminating enemy waves or supporting their own, affecting 
                        lane control and map pressure. This type of multiplayer online video games originated as a subgenre of real-time strategy; 
                        however, most the traditional RTS elements, such as building construction and unit production, were removed in favor of a 
                        more focused player-versus-player experience. The genre blends elements of real-time strategy, 
                        role-playing, and action games, combining strategic depth with individual character progression and fast-paced combat.</p>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                </div>
                <div class="col-12">
                    <h1 style="font-size: 20px;"> Key Word</h1>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> Street Fighter</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> The King of Fighters</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> Mortal Kombat</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> Samurai Shodown</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> Darkstalkers</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> Tekken</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> mugen</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> AAA</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> AAA</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> AAA</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> AAA</p>
                </div>
                <div class="col-2">
                    <p style="font-size: 20px;"> AAA</p>
                </div>
            </div>

            <!-- 简短介绍 -->

            <div class="row">
                <div class="col-12">
                    <div class="menu">
                        <div class="role_info">
                            <img alt="角色" width="25px" class="avatar role_pic" src="assets/25.jpg">
                            <span id="role_info_name" class="role_name">Not logged in</span>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <main onclick="mainCLick(event)" style="text-align: left">
                        <div class="form_item">
                            <div class="fake_input_box">
                                <label class="role_input_box">User：<input id="commentator"
                                        placeholder="Please enter the name of the character you wish to play at this moment.
                                         After confirmation, it will be displayed in the upper right corner" /></label>
                                <button onclick="login()" class="role_confirm_btn">Log in</button>
                            </div>
                        </div>
                        <hr />
                        <div class="form_item">
                            <label class="label_img">
                                <img src="assets/25.jpg" alt="头像" width="50px"
                                    style="border-radius: 100%; vertical-align: top">
                            </label>
                            <textarea id="comment_space" onkeyup="readKey(event)" placeholder="请输入您要评论的内容"></textarea>
                        </div>
                        <div id="button_submit_div">
                            <div style="position: relative">
                                <span style="color: lightgray; margin-right: 20px">
                                    You can still input <span id="char_count">1000</span> characters
                                </span>
                                <button class="confirm_btn" id="cancel_reply" onclick="cancelReply(event, this)"
                                    style="margin-right: 20px; display: none">Cancel the reply</button>
                                <button onclick="emojiTrigger(event)" class="emoji_trigger_btn">🙂</button>
                                <button class="confirm_btn" id="submit_button" onclick="submitTree(event)">Submit</button>
                                <div id="emoji_board" class="emoji_board">
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div id="comment_view">
                        </div>
                    </main>
                </div>

                <script type="text/javascript">

                    getRandomId = function () {
                        return 'id'.concat(Math.floor((Math.random() * 10000000000000000)).toString());
                    };
                    getCurrentTime = function () {
                        return new Date().toLocaleString();
                    };

                    var curArr = null;

                    var commentList = [];

                    window.onload = function (ev) {
                        // the function will be called at first while page loads
                        initTreeComment();
                        loadEmoji();
                    };

                    function loadEmoji() {
                        const dom = domById('emoji_board');
                        // &#128540;
                        const fragment = document.createDocumentFragment();
                        let num = 128512;
                        for (let i = 0; i < 6; ++i) {
                            const p = document.createElement('p');
                            p.className = 'emoji_row';
                            const pf = document.createDocumentFragment();
                            for (let j = 0; j < 9; ++j) {
                                const span = document.createElement('span');
                                span.className = 'emoji_item'
                                span.innerHTML = '&#' + num + ';';
                                span.onclick = function () {
                                    setEmojiToContent(this.innerText);
                                }
                                pf.append(span);
                                ++num;
                            }
                            p.appendChild(pf);
                            fragment.append(p);
                        }
                        dom.appendChild(fragment);
                    }

                    function setEmojiToContent(emo) {
                        domById('comment_space').value += emo;
                    }

                    function emojiTrigger(ev) {
                        ev.stopPropagation();
                        const dom = domById('emoji_board');
                        const block = dom.style.display;
                        if (block === 'block') {
                            dom.style.display = 'none';
                        } else {
                            dom.style.display = 'block';
                        }
                    }

                    function login() {
                        const commentator = domById('commentator').value.trim();
                        if (commentator.length > 0) {
                            domById('role_info_name').innerText = commentator;
                        }
                        initTreeComment();
                    }

                    /**
                     * 初始化评论模块
                     */
                    initTreeComment = function () {
                        const commentView = domById('comment_view');
                        if (commentList.length === 0) {
                            noComment(commentView)
                        } else {
                            haveComment(commentView, commentList)
                        }
                    };

                    noComment = function (commentView) {
                        commentView.style.textAlign = 'center';
                        commentView.innerText = 'No comments'
                    };

                    /**
                     * 点击 “提交” 按钮调用的函数
                     * @param ev
                     */
                    function submitTree(ev) {
                        const textareaEle = domById('comment_space');
                        ev.stopPropagation();
                        const text = textareaEle.value;
                        const commentator = domById('role_info_name').innerText;

                        if (text.length === 0 || commentator === 'Not logged in') {
                            alarmIfEmpSpace();
                            return;
                        }

                        let plcHolder = textareaEle.placeholder;

                        if (plcHolder.charAt(0) === '回') {
                            plcHolder = plcHolder.substring(plcHolder.indexOf(' ') + 1, plcHolder.length)
                        } else {
                            curArr = commentList;
                            plcHolder = "anonymous";
                        }

                        if (commentator === plcHolder) {
                            cancelReply(event, domById('cancel_reply'));
                            alert("You can't comment on or reply to yourself!");
                            return;
                        }

                        /*
                        * hash表用于保存当前评论的点赞角色名称，默认值位 false
                        * */
                        const admirers = new Map();
                        admirers.set(commentator, false);
                        const commentTree = {
                            id: getRandomId(),
                            commentator: commentator,
                            author: plcHolder,
                            comment: text,
                            time: getCurrentTime(),
                            thumbUp: 0,
                            admirers: admirers,
                            reply: []
                        };
                        curArr.push(commentTree);
                        initTreeComment();
                        curArr = null;
                        cancelReply(event, domById('cancel_reply'));
                    }

                    alarmIfEmpSpace = function () {
                        alert("The comment content or name are empty！")
                    };

                    /**
                     * 取消回复
                     * @param ev 事件
                     * @param th 回复按钮自身的 DOM 属性
                     */
                    function cancelReply(ev, th) {
                        ev.stopPropagation();
                        th.style.display = 'none';
                        domById('comment_space').value = "";
                        countTextareaLength();
                        fillPlaceholderOfCommentSpace("Please enter the content you want to comment on");
                    }

                    /**
                     * 计算输入框的内容长度
                     */
                    function countTextareaLength() {
                        const space = domById('comment_space');
                        document.getElementById('char_count').innerText = (1000 - space.value.length).toString();
                    }

                    /**
                     * 输入框触发按键事件，并执行相关操作，比如记录输入内容的长度
                     * @param ev 事件
                     */
                    function readKey(ev) {
                        const space = domById('comment_space'), len = space.value.length;
                        document.getElementById('char_count').innerText = (1000 - len).toString();
                        handleCancelButton(space, len > 0 ? 'inline-block' : 'none')
                    }

                    function handleCancelButton(textArea, status) {
                        domById('cancel_reply').style.display = status;
                    }

                    /**
                     * 评论加载
                     * @param commentView
                     * @param arr
                     */
                    haveComment = function (commentView, arr) {

                        commentView.style.textAlign = 'left';

                        let htmlText = '';
                        arr.forEach(function (value) {
                            htmlText +=
                                `<ul id="${value.id}" class="comment_ulist" style="">` +
                                `  <li class="comment_line_box" id="${value.id.substring(0, 6)}">` +
                                `    <div class="cmt_img">` +
                                `      <img alt="头像" class="avatar" src="assets/19.jpg" width="30px" style="border-radius: 100%">` +
                                `    </div>` +
                                `    <div class="cmt_info">` +
                                `      <a class="commentator">${value.commentator}</a>` +
                                `      <span class="time">${value.time}</span>` +
                                `   </div>` +
                                `   <div class="cmt_reply">` +
                                `       <span id="${value.id.substring(0, 9)}">` +
                                `           <a class="cmt_reply_btn" id="${value.id.substring(0, 7)}">Reply</a>` +
                                `       </span>`;

                            if (value.reply.length > 0) {
                                htmlText += `<a id="${value.id.substring(0, 8)}" class="cmt_reply_checker">View the reply(${value.reply.length})</a>`
                            }
                            // 初始化当前角色是否给该条留言点赞了
                            const commentator = domById('role_info_name').innerText;
                            const isAdmirer = value.admirers.get(commentator);
                            let color = 'rgba(0,0,0,0.9)';
                            if (!isAdmirer) {
                                color = 'rgba(0,0,0,0.4)';
                            }
                            htmlText += "" +
                                `   <span>` +
                                `       <a style="color:${color}" id="${value.id.substring(0, 10)}" class="thumb_up">${(value.thumbUp > 0 ? value.thumbUp : "")}</a>` +
                                `   </span>` +
                                `</div>`;
                            htmlText += ` <div style="display: block; margin-top: 8px" class="comment">${value.comment}</div>`;
                            htmlText += `</li></ul>`;
                        });

                        commentView.innerHTML = htmlText;

                        showButton(arr, 1)
                    };

                    function thumbUp(value) {
                        const dom = domById(value.id.substring(0, 10));
                        dom.onclick = function (ev) {
                            const cnt = value.thumbUp;
                            const commentator = domById('role_info_name').innerText;
                            const isAdmired = value.admirers.get(commentator);
                            if (!value.admirers.has(commentator)) {
                                value.admirers.set(commentator, false);
                            }
                            if (isAdmired) {
                                value.thumbUp -= 1;
                                dom.innerText = value.thumbUp === 0 ? '' : (cnt - 1).toString();
                                dom.style.color = 'rgba(0,0,0,0.4)';
                            } else {
                                value.thumbUp += 1;
                                dom.innerText = value.thumbUp.toString();
                                dom.style.color = 'rgba(0,0,0,0.9)';
                            }
                            value.admirers.set(commentator, !isAdmired);
                            // TODO 发送请求到后端，并更新数据库
                            /**
                             * @Tip 这里需要注意一点，点赞功能会存在恶意点击的情况，就是用户对当前评论频繁且快速点赞或取消点赞，如果每次点击我们都请求后端更新数据
                             * 那么势必会影响服务器的性能，因此我们需要避免这一点，这里不做解释，大家有兴趣可以评论区留言探讨
                             */
                        }
                    }

                    showButton = function (arr, sign) {

                        arr.forEach(function (value) {

                            const parent = domById(value.id);
                            const broEle = domById(value.id.substring(0, 6));

                            const reply = domById(value.id.substring(0, 7));

                            broEle.onmouseover = function (ev) {
                                reply.style.display = 'inline-block';
                            };

                            thumbUp(value);

                            reply.onclick = function (ev) {
                                ev.stopPropagation();
                                curArr = sign === 1 ? value.reply : arr;
                                domById('cancel_reply').style.display = 'inline-block';
                                const str = "Reply ".concat(value.commentator);
                                fillPlaceholderOfCommentSpace(str)
                            };

                            const replyLen = value.reply.length;
                            if (replyLen > 0) {
                                handleReply(replyLen, value, broEle, parent);
                            }

                            broEle.onmouseleave = function (ev) {
                                reply.style.display = 'none'
                            };
                        });
                    };

                    function handleReply(len, value, broEle, parent) {
                        const checkReply = domById(value.id.substring(0, 8));
                        checkReply.onclick = (ev) => {
                            ev.stopPropagation();
                            if (checkReply.innerText.trim().charAt(0) === '查') {
                                ifHaveReply(parent, value.reply, broEle);
                                checkReply.innerText = "Stop replying";
                            } else {
                                toggleBackReplies(parent);
                                checkReply.innerText = "View the reply(" + len + ")";
                            }
                        };
                    }

                    toggleBackReplies = function (parentTag) {
                        const nodes = parentTag.childNodes;
                        parentTag.removeChild(nodes[nodes.length - 1]);
                    };

                    ifHaveReply = function (parentTag, arr, broEle) {
                        const li = document.createElement("li");
                        li.className = "reply_list";
                        li.style.marginLeft = '42px';
                        li.style.borderLeft = 'solid 5px lightgray';

                        let htmlText = '<ul class="comment_ulist">';

                        arr.forEach(function (value) {
                            // 初始化当前角色是否给该条留言点赞了
                            const commentator = domById('role_info_name').innerText;
                            const isAdmirer = value.admirers.get(commentator);
                            let color = 'rgba(0,0,0,0.9)';
                            if (!isAdmirer) {
                                color = 'rgba(0,0,0,0.4)';
                            }

                            htmlText +=
                                `<li class="comment_line_box" id="${value.id.substring(0, 6)}">` +
                                `   <div class="cmt_img" style="margin-left: 10px">` +
                                `       <img alt="头像" class="avatar" src="../assets/25.jpg" width="30px" style="border-radius: 100%">` +
                                `   </div>` +
                                `   <div class="cmt_info">` +
                                `       <a class="commentator">${value.commentator}</a>` +
                                `       <span>Reply</span>` +
                                `       <a class="author">${value.author}</a>` +
                                `       <span class="time">${value.time}</span>` +
                                `   </div>` +
                                `   <div class="cmt_reply">` +
                                `       <span id="${value.id.substring(0, 9)}">` +
                                `           <a class="cmt_reply_btn" id="${value.id.substring(0, 7)}">Reply</a>` +
                                `       </span>` +
                                `       <span>` +
                                `           <a style="color:${color}" id="${value.id.substring(0, 10)}" class="thumb_up">${(value.thumbUp > 0 ? value.thumbUp : "")}</a>` +
                                `       </span>` +
                                `   </div>` +
                                `   <div class="comment">${value.comment}</div>` +
                                `</li>`;
                        });
                        htmlText += '</ul>';
                        li.innerHTML = htmlText;
                        parentTag.insertBefore(li, broEle.nextSibling);
                        showButton(arr, 2)
                    };

                    fillPlaceholderOfCommentSpace = function (str) {
                        document.getElementById('comment_space').placeholder = str
                    };

                    mainCLick = function (ev) {
                        ev.stopPropagation();
                        domById('emoji_board').style.display = 'none';
                    };

                    function len(id) {
                        return domById(id).value.trim().length;
                    }

                    function domById(id) {
                        return document.getElementById(id);
                    }
                </script>
            </div>
        </div>

        </section>


        <!-- 页面专用脚本 -->
        <script type="module" src="js/style_guide.js"></script>


        <!-- 公共样式 -->
        <link rel="stylesheet" href="css/reset.css" />
        <link rel="stylesheet" href="css/base.css" />
        <link rel="stylesheet" href="css/layout.css" />
        <link rel="stylesheet" href="css/components.css" />
        <!-- 新增：赛博朋克风格布局 -->
        <link rel="stylesheet" href="css/cyberpunk_layout.css">
        <!-- 页面专用样式 -->
        <link rel="stylesheet" href="css/page_css/style_guide.css" />

        <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;700&display=swap" rel="stylesheet">
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />



        <!-- 页面专用脚本 -->
        <script type="module" src="js/style_guide.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
        <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script
            src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
</body>

</html>